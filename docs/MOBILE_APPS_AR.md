# تطبيقات الجوال — أندرويد و iOS/iPad

التطبيق يعمل كـ **تطبيق جوال أصلي** (أندرويد + آيفون/آيباد) عبر **Capacitor**، ويحمّل الواجهة من السيرفر، لذلك **أي تحديث على السيرفر يظهر تلقائياً** للمستخدمين دون الحاجة لتحديث التطبيق من المتجر.

---

## المتطلبات

- **أندرويد:** Android Studio و JDK (لبناء وتشغيل المحاكي أو الجهاز)
- **iOS/iPad:** جهاز Mac و Xcode (لبناء وتشغيل المحاكي أو الجهاز)
- **السيرفر:** يعمل محلياً أو على استضافة (الواجهة على نفس السيرفر مع الـ API)

---

## الإعداد المحلي (السيرفر على جهازك)

### 1. تشغيل السيرفر

```bash
# الطرفية الأولى: واجهة الويب (Vite)
npm run dev

# الطرفية الثانية: الـ API
npm run dev:api
```

الواجهة ستكون على: `http://localhost:3000/app/`  
الـ API على: `http://localhost:4000`

### 2. ضبط عنوان السيرفر في التطبيق

الملف **`capacitor.config.json`** يحتوي على حقل `server.url`. غيّره حسب طريقة التشغيل:

| البيئة | القيمة المقترحة لـ `server.url` |
|--------|----------------------------------|
| **أندرويد محاكي** | `http://10.0.2.2:3000/app/` |
| **آيفون/آيباد محاكي (على Mac)** | `http://localhost:3000/app/` |
| **جهاز حقيقي (جوال/تابلت)** | `http://IP_جهازك:3000/app/` (مثال: `http://192.168.1.100:3000/app/`) |

مثال لجهاز حقيقي على نفس الشبكة:

```json
"server": {
  "url": "http://192.168.1.100:3000/app/",
  "cleartext": true
}
```

بعد أي تعديل على `server.url` نفّذ:

```bash
npm run cap:sync
```

### 3. فتح مشروع أندرويد

```bash
npm run cap:android
```

يفتح Android Studio. من هناك:

- **تشغيل على محاكي:** اختر جهازاً ثم Run
- **تشغيل على جهاز:** وصّل الجهاز وفعّل USB debugging ثم Run

التطبيق سيفتح ويحمّل الواجهة من العنوان المضبوط في `server.url`.

### 4. فتح مشروع iOS (يتطلب Mac)

```bash
npm run cap:ios
```

يفتح Xcode. اختر محاكي آيفون أو آيباد أو جهاز حقيقي ثم Run.  
تأكد أن `server.url` في `capacitor.config.json` يناسب البيئة (مثلاً `localhost` للمحاكي على نفس الجهاز).

---

## دعم أحجام الشاشات

- **أندرويد:** يدعم الجوال والتابلت وجميع الكثافات؛ التصميم المتجاوب في الويب يتكيّف تلقائياً.
- **iOS:** يدعم آيفون وآيباد وجميع الاتجاهات (عمودي/أفقي)؛ مضبوط في المشروع الافتراضي.

لا تحتاج خطوات إضافية لدعم أحجام الشاشات طالما الواجهة متجاوبة في المتصفح.

---

## التحديث التلقائي من السيرفر

التطبيق **لا يخزّن صفحات الويب داخله**؛ يفتح عنوان السيرفر في كل مرة. لذلك:

- أي تعديل على الواجهة أو المنطق على السيرفر يظهر فوراً للمستخدم عند فتح التطبيق أو تحديث الصفحة.
- البيانات (حجوزات، أعضاء، نوادي…) مرتبطة دائماً بالسيرفر لأن الطلبات تذهب إلى نفس الـ API.

---

## الرفع لاحقاً إلى سيرفر حقيقي

1. ارفع مشروعك (واجهة + API) إلى الاستضافة (نفس الدومين أو subdomain مع الـ API).
2. غيّر **`server.url`** في **`capacitor.config.json`** إلى عنوان الواجهة الفعلي، مثلاً:
   ```json
   "server": {
     "url": "https://app.yourdomain.com/app/",
     "cleartext": false
   }
   ```
3. ضبط **`cleartext`**:
   - إذا كان الموقع **HTTPS** فقط: اجعل `"cleartext": false` أو احذف المفتاح.
   - لا تستخدم `cleartext: true` على الإنتاج إلا إذا كان لديك سبب أمني واضح.
4. نفّذ:
   ```bash
   npm run cap:sync
   ```
5. أعد بناء التطبيق من Android Studio و Xcode ثم انشر النسخ الجديدة (APK/AAB أو IPA) كما تفعل عادة.

بعد ذلك التطبيق سيحمّل من السيرفر الجديد وستستمر التحديثات التلقائية من السيرفر دون الحاجة لإصدار جديد من المتجر لكل تغيير واجهة.

---

## أوامر سريعة

| الأمر | الوصف |
|--------|--------|
| `npm run cap:sync` | بناء الويب ثم مزامنة المشاريع الأصيلة (يفضّل بعد تغيير `server.url`) |
| `npm run cap:android` | فتح مشروع أندرويد في Android Studio |
| `npm run cap:ios` | فتح مشروع iOS في Xcode (على Mac) |

---

## ملاحظات

- على **جهاز حقيقي** تأكد أن الجوال/التابلت والكمبيوتر على **نفس الشبكة** وأن الجدار الناري لا يمنع المنفذ 3000.
- للإنتاج استخدم **HTTPS** دائماً واتبع سياسات أمان المتاجر (مثلاً لا تعتمد على HTTP فقط في التطبيق النهائي إلا إن كان مسموحاً في بيئتك).
